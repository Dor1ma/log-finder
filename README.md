# log-finder

Cервис с REST интерфейсом, позволяющий через REST найти в группе локальных лог файлов сообщение, залогированное с определенным timestamp, и вернуть это сообщение в качестве ответа на запрос

## Описание технической составляющей

Сервис состоит из следующих компонентов:

1. REST API (HTTP Server)
2. Обработчик запросов
3. Кеш запросов
4. Менеджер лог-файлов
5. Индекс временных диапазонов
6. Поисковый движок

Ключевые особенности:

1. Предварительная индексация файлов по временным диапазонам
2. Бинарный поиск по таймстемпам
3. LRU-кеш с TTL
4. Использование mmap для работы с большими файлами
5. Потоковое чтение с буферизацией
6. Автоматическое восстановление кеша
7. Ограничение максимального числа открытых файлов
8. Автоматическое работа с новыми log файлами

## Инструкция по запуску

### Важно

Из условия я предположил, что 1 лог равен строго **одной строке** в файле. Примеры, можно посмотреть в директории ./test_logs_directory

### Процесс запуска

1. Создайте и заполните .env файл по аналогии с .env_example:

    ```bash
    LOG_DIR=/var/log/app # Имя директории, которая создатся внутри контейнера
    SERVER_PORT=8081 # Порт сервера
    CACHE_TTL=10m # TTL для кэша
    MAX_OPEN_FILES=50 # Максимальное количество открытых файлов
    FILE_CACHE_TTL=30m # TTL для файлового кэша
    RATE_LIMIT=200 # Рейт лимит
    REFRESH_INTERVAL=60 # Интервал для обновления информации о log файлах в минутах
    ```

2. Добавьте директорию с логами той машины, на которой планируете запустить сервис, в блок volumes в docker-compose в качестве
первого параметра. Если говорить на примере данного репозитория, то после его клонирования с гитхаба это поле можно оставить без изменений (./test_logs_directory)

3. Поднимите сервис командой:
    ```bash
    docker-compose up -d
    ```

4. После запуска сервис будет доступен по адресу 10.5.0.2. Пример запроса к сервису:
    ```bash
    curl -X GET "http://10.5.0.2:8081/logs?timestamp=2024-06-10T13:41:12.100"
    ```